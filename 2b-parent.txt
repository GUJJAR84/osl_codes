#include <iostream>
#include <unistd.h>
#include <sys/wait.h>
#include <vector>
using namespace std;

void bubbleSort(int a[], int n){
    for(int i=0;i<n-1;i++)
        for(int j=0;j<n-1-i;j++)
            if(a[j] > a[j+1]) swap(a[j], a[j+1]);
}

int main(){
    int n;
    cout << "Enter number of integers: ";
    cin >> n;

    int arr[n];
    cout << "Enter integers: ";
    for(int i=0;i<n;i++) cin >> arr[i];

    bubbleSort(arr, n);

    cout << "Sorted array: ";
    for(int i=0;i<n;i++) cout << arr[i] << " ";
    cout << "\n";

    int pid = fork();

    if(pid == 0){
        // CHILD PROCESS

        // Build execve argument list
        string path = "./child";
        vector<string> sargs;

        sargs.push_back(path);           // program name
        sargs.push_back(to_string(n));   // size

        for(int i=0;i<n;i++)
            sargs.push_back(to_string(arr[i]));

        int target;
        cout << "Enter element to search: ";
        cin >> target;

        sargs.push_back(to_string(target));

        // convert vector<string> to char* for execve
        vector<char*> args;
        for(string &s : sargs) args.push_back(const_cast<char*>(s.c_str()));
        args.push_back(NULL);

        execve(path.c_str(), args.data(), NULL);

        perror("execve failed");
        _exit(1);
    }
    else {
        wait(NULL);
        cout << "Parent: Child completed binary search.\n";
    }

    return 0;
}
